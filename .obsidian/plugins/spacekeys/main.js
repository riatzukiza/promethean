/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var He=Object.create;var U=Object.defineProperty;var _e=Object.getOwnPropertyDescriptor;var Ve=Object.getOwnPropertyNames;var We=Object.getPrototypeOf,je=Object.prototype.hasOwnProperty;var Ue=(n,t)=>{for(var e in t)U(n,e,{get:t[e],enumerable:!0})},ue=(n,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Ve(t))!je.call(n,i)&&i!==e&&U(n,i,{get:()=>t[i],enumerable:!(r=_e(t,i))||r.enumerable});return n};var $e=(n,t,e)=>(e=n!=null?He(We(n)):{},ue(t||!n||!n.__esModule?U(e,"default",{value:n,enumerable:!0}):e,n)),Ye=n=>ue(U({},"__esModule",{value:!0}),n);var ht={};Ue(ht,{default:()=>Z});module.exports=Ye(ht);var c=require("obsidian");var de=/^(.|[a-z]+|f[1-9]|f1[0-2])$/i,fe={" ":"SPC",enter:"ENT",tab:"TAB",backspace:"BSP",arrowup:"Up",arrowdown:"Down",arrowleft:"Left",arrowright:"Right"},Qe={" ":"SPC",enter:"\u21B5",tab:"TAB",backspace:"\u232B",arrowup:"\u2191",arrowdown:"\u2193",arrowleft:"\u2190",arrowright:"\u2192"};function N(n){return n.length==1&&n!=" "}var E=class{constructor(t,e={}){var r,i,a,s;this.key=t,this.ctrl=(r=e.ctrl)!=null?r:!1,this.shift=(i=e.shift)!=null?i:!1,this.alt=(a=e.alt)!=null?a:!1,this.meta=(s=e.meta)!=null?s:!1}static fromEvent(t){let e=t.key;e.length>1&&(e=e.toLowerCase());let r={ctrl:t.ctrlKey,shift:t.shiftKey,alt:t.altKey,meta:t.metaKey},i=new E(e,r);return N(e)&&(i.shift=!1),i}static compare(t,e){if(t.key!=e.key){let r=N(t.key),i=N(e.key);return!r&&i?-1:r&&!i?1:t.key.localeCompare(e.key)}return!t.ctrl&&e.ctrl?-1:t.ctrl&&!e.ctrl?1:!t.shift&&e.shift?-1:t.shift&&!e.shift?1:!t.alt&&e.alt?-1:t.alt&&!e.alt?1:!t.meta&&e.meta?-1:t.meta&&!e.meta?1:0}equals(t){return this.key==t.key&&this.ctrl==t.ctrl&&this.shift==t.shift&&this.alt==t.alt&&this.meta==t.meta}basicRepr(){let t="";return this.ctrl&&(t+="C"),this.shift&&!N(this.key)&&(t+="S"),this.alt&&(t+="A"),this.meta&&(t+="M"),t&&(t+="-"),this.key in fe?t+=fe[this.key]:this.key.length>1?t+=this.key.toUpperCase():t+=this.key,t}fancyRepr(){var e;let t="";return this.ctrl&&(t+="^"),this.shift&&!N(this.key)&&(t+="\u21E7"),this.alt&&(t+="\u2387"),this.meta&&(t+="\u229E"),t+=(e=Qe[this.key])!=null?e:this.key,t}},b=class{constructor(t,e=null){this.command_id=t;this.description=e}},w=class{constructor(t=null){this.description=t,this.children=[]}isEmpty(){return this.children.length==0}setChild(t,e){for(let r=0;r<this.children.length;r++)if(this.children[r].key.equals(t)){this.children[r]={key:t,item:e};return}this.children.push({key:t,item:e})}removeChild(t){for(let e=0;e<this.children.length;e++)if(this.children[e].key.equals(t))return this.children.splice(e,1)[0].item;return null}getChild(t){for(let e of this.children)if(e.key.equals(t))return e.item;return null}find(t,e=!1){let r=this,i;for(let a of t){if(r instanceof b)return e?null:r;if(i=r.getChild(a),!i)return null;r=i}return r}copy(){let t=new w(this.description);for(let e of this.children)t.children.push({...e});return t}};var L=require("obsidian");var _=require("obsidian");var v=require("@codemirror/state"),x=require("@codemirror/language"),qe=$e(require("@codemirror/view"),1),F=require("@codemirror/view"),D=require("@codemirror/search"),g=require("@codemirror/commands");function C(n,t){var e=t.ch,r=t.line+1;r<1&&(r=1,e=0),r>n.lines&&(r=n.lines,e=Number.MAX_VALUE);var i=n.line(r);return Math.min(i.from+Math.max(0,e),i.to)}function S(n,t){let e=n.lineAt(t);return{line:e.number-1,ch:t-e.from}}var M=class{constructor(t,e){this.line=t,this.ch=e}};function ve(n,t,e){if(n.addEventListener)n.addEventListener(t,e,!1);else{var r=n._handlers||(n._handlers={});r[t]=(r[t]||[]).concat(e)}}function me(n,t,e){if(n.removeEventListener)n.removeEventListener(t,e,!1);else{var r=n._handlers,i=r&&r[t];if(i){var a=i.indexOf(e);a>-1&&(r[t]=i.slice(0,a).concat(i.slice(a+1)))}}}function ye(n,t,...e){var r,i=(r=n._handlers)===null||r===void 0?void 0:r[t];if(i)for(var a=0;a<i.length;++a)i[a](...e)}function he(n,...t){if(n)for(var e=0;e<n.length;++e)n[e](...t)}var te;try{te=new RegExp("[\\w\\p{Alphabetic}\\p{Number}_]","u")}catch(n){te=/[\w]/}function V(n,t){var e=n.cm6;if(!e.state.readOnly){var r="input.type.compose";if(n.curOp&&(n.curOp.lastChange||(r="input.type.compose.start")),t.annotations)try{t.annotations.some(function(i){i.value=="input"&&(i.value=r)})}catch(i){console.error(i)}else t.userEvent=r;return e.dispatch(t)}}function pe(n,t){var e;n.curOp&&(n.curOp.$changeStart=void 0),(t?g.undo:g.redo)(n.cm6);let r=(e=n.curOp)===null||e===void 0?void 0:e.$changeStart;r!=null&&n.cm6.dispatch({selection:{anchor:r}})}var Ge={},d=class{constructor(t){this.state={},this.marks=Object.create(null),this.$mid=0,this.options={},this._handlers={},this.$lastChangeEndOffset=0,this.virtualSelection=null,this.cm6=t,this.onChange=this.onChange.bind(this),this.onSelectionChange=this.onSelectionChange.bind(this)}openDialog(t,e,r){return Je(this,t,e,r)}openNotification(t,e){return ze(this,t,e)}on(t,e){ve(this,t,e)}off(t,e){me(this,t,e)}signal(t,e,r){ye(this,t,e,r)}indexFromPos(t){return C(this.cm6.state.doc,t)}posFromIndex(t){return S(this.cm6.state.doc,t)}foldCode(t){let e=this.cm6,r=e.state.selection.ranges,i=this.cm6.state.doc,a=C(i,t),s=v.EditorSelection.create([v.EditorSelection.range(a,a)],0).ranges;e.state.selection.ranges=s,(0,x.foldCode)(e),e.state.selection.ranges=r}firstLine(){return 0}lastLine(){return this.cm6.state.doc.lines-1}lineCount(){return this.cm6.state.doc.lines}setCursor(t,e){typeof t=="object"&&(e=t.ch,t=t.line);var r=C(this.cm6.state.doc,{line:t,ch:e||0});this.cm6.dispatch({selection:{anchor:r}},{scrollIntoView:!this.curOp}),this.curOp&&!this.curOp.isVimOp&&this.onBeforeEndOperation()}getCursor(t){var e=this.cm6.state.selection.main,r=t=="head"||!t?e.head:t=="anchor"?e.anchor:t=="start"?e.from:t=="end"?e.to:null;if(r==null)throw new Error("Invalid cursor type");return this.posFromIndex(r)}listSelections(){var t=this.cm6.state.doc;return this.cm6.state.selection.ranges.map(e=>({anchor:S(t,e.anchor),head:S(t,e.head)}))}setSelections(t,e){var r=this.cm6.state.doc,i=t.map(a=>{var s=C(r,a.head),o=C(r,a.anchor);return s==o?v.EditorSelection.cursor(s,1):v.EditorSelection.range(o,s)});this.cm6.dispatch({selection:v.EditorSelection.create(i,e)})}setSelection(t,e,r){this.setSelections([{anchor:t,head:e}],0),r&&r.origin=="*mouse"&&this.onBeforeEndOperation()}getLine(t){var e=this.cm6.state.doc;return t<0||t>=e.lines?"":this.cm6.state.doc.line(t+1).text}getLineHandle(t){return this.$lineHandleChanges||(this.$lineHandleChanges=[]),{row:t,index:this.indexFromPos(new M(t,0))}}getLineNumber(t){var e=this.$lineHandleChanges;if(!e)return null;for(var r=t.index,i=0;i<e.length;i++)if(r=e[i].changes.mapPos(r,1,v.MapMode.TrackAfter),r==null)return null;var a=this.posFromIndex(r);return a.ch==0?a.line:null}releaseLineHandles(){this.$lineHandleChanges=void 0}getRange(t,e){var r=this.cm6.state.doc;return this.cm6.state.sliceDoc(C(r,t),C(r,e))}replaceRange(t,e,r,i){r||(r=e);var a=this.cm6.state.doc,s=C(a,e),o=C(a,r);V(this,{changes:{from:s,to:o,insert:t}})}replaceSelection(t){V(this,this.cm6.state.replaceSelection(t))}replaceSelections(t){var e=this.cm6.state.selection.ranges,r=e.map((i,a)=>({from:i.from,to:i.to,insert:t[a]||""}));V(this,{changes:r})}getSelection(){return this.getSelections().join(`
`)}getSelections(){var t=this.cm6;return t.state.selection.ranges.map(e=>t.state.sliceDoc(e.from,e.to))}somethingSelected(){return this.cm6.state.selection.ranges.some(t=>!t.empty)}getInputField(){return this.cm6.contentDOM}clipPos(t){var e=this.cm6.state.doc,r=t.ch,i=t.line+1;i<1&&(i=1,r=0),i>e.lines&&(i=e.lines,r=Number.MAX_VALUE);var a=e.line(i);return r=Math.min(Math.max(0,r),a.to-a.from),new M(i-1,r)}getValue(){return this.cm6.state.doc.toString()}setValue(t){var e=this.cm6;return e.dispatch({changes:{from:0,to:e.state.doc.length,insert:t},selection:v.EditorSelection.range(0,0)})}focus(){return this.cm6.focus()}blur(){return this.cm6.contentDOM.blur()}defaultTextHeight(){return this.cm6.defaultLineHeight}findMatchingBracket(t,e){var r=this.cm6.state,i=C(r.doc,t),a=(0,x.matchBrackets)(r,i+1,-1);return a&&a.end?{to:S(r.doc,a.end.from)}:(a=(0,x.matchBrackets)(r,i,1),a&&a.end?{to:S(r.doc,a.end.from)}:{to:void 0})}scanForBracket(t,e,r,i){return et(this,t,e,r,i)}indentLine(t,e){e?this.indentMore():this.indentLess()}indentMore(){(0,g.indentMore)(this.cm6)}indentLess(){(0,g.indentLess)(this.cm6)}execCommand(t){if(t=="indentAuto")d.commands.indentAuto(this);else if(t=="goLineLeft")(0,g.cursorLineBoundaryBackward)(this.cm6);else if(t=="goLineRight"){(0,g.cursorLineBoundaryForward)(this.cm6);let e=this.cm6.state,r=e.selection.main.head;r<e.doc.length&&e.sliceDoc(r,r+1)!==`
`&&(0,g.cursorCharBackward)(this.cm6)}else console.log(t+" is not implemented")}setBookmark(t,e){var r=e!=null&&e.insertLeft?1:-1,i=this.indexFromPos(t),a=new re(this,i,r);return a}addOverlay({query:t}){let e=new D.SearchQuery({regexp:!0,search:t.source,caseSensitive:!/i/.test(t.flags)});if(e.valid){e.forVim=!0,this.cm6Query=e;let r=D.setSearchQuery.of(e);return this.cm6.dispatch({effects:r}),e}}removeOverlay(t){if(!this.cm6Query)return;this.cm6Query.forVim=!1;let e=D.setSearchQuery.of(this.cm6Query);this.cm6.dispatch({effects:e})}getSearchCursor(t,e){var r=this,i=null,a=null;e.ch==null&&(e.ch=Number.MAX_VALUE);var s=C(r.cm6.state.doc,e),o=t.source.replace(/(\\.|{(?:\d+(?:,\d*)?|,\d+)})|[{}]/g,function(u,m){return m||"\\"+u});function l(u,m=0,y=u.length){return new D.RegExpCursor(u,o,{ignoreCase:t.ignoreCase},m,y)}function h(u){var m=r.cm6.state.doc;if(u>m.length)return null;let y=l(m,u).next();return y.done?null:y.value}var f=1e4;function p(u,m){var y=r.cm6.state.doc;for(let O=1;;O++){let k=Math.max(u,m-O*f),j=l(y,k,m),H=null;for(;!j.next().done;)H=j.value;if(H&&(k==u||H.from>k+10))return H;if(k==u)return null}}return{findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(u){var m=r.cm6.state.doc;if(u){let y=i?i.from==i.to?i.to-1:i.from:s;i=p(0,y)}else{let y=i?i.from==i.to?i.to+1:i.to:s;i=h(y)}return a=i&&{from:S(m,i.from),to:S(m,i.to),match:i.match},i&&i.match},from:function(){return a==null?void 0:a.from},to:function(){return a==null?void 0:a.to},replace:function(u){i&&(V(r,{changes:{from:i.from,to:i.to,insert:u}}),i.to=i.from+u.length,a&&(a.to=S(r.cm6.state.doc,i.to)))}}}findPosV(t,e,r,i){let{cm6:a}=this,s=a.state.doc,o=r=="page"?a.dom.clientHeight:0,l=C(s,t),h=v.EditorSelection.cursor(l,1,void 0,i),f=Math.round(Math.abs(e));for(let u=0;u<f;u++)r=="page"?h=a.moveVertically(h,e>0,o):r=="line"&&(h=a.moveVertically(h,e>0));let p=S(s,h.head);return(e<0&&h.head==0&&i!=0&&t.line==0&&t.ch!=0||e>0&&h.head==s.length&&p.ch!=i&&t.line==p.line)&&(p.hitSide=!0),p}charCoords(t,e){var r=this.cm6.contentDOM.getBoundingClientRect(),i=C(this.cm6.state.doc,t),a=this.cm6.coordsAtPos(i),s=-r.top;return{left:((a==null?void 0:a.left)||0)-r.left,top:((a==null?void 0:a.top)||0)+s,bottom:((a==null?void 0:a.bottom)||0)+s}}coordsChar(t,e){var r=this.cm6.contentDOM.getBoundingClientRect(),i=this.cm6.posAtCoords({x:t.left+r.left,y:t.top+r.top})||0;return S(this.cm6.state.doc,i)}getScrollInfo(){var t=this.cm6.scrollDOM;return{left:t.scrollLeft,top:t.scrollTop,height:t.scrollHeight,width:t.scrollWidth,clientHeight:t.clientHeight,clientWidth:t.clientWidth}}scrollTo(t,e){t!=null&&(this.cm6.scrollDOM.scrollLeft=t),e!=null&&(this.cm6.scrollDOM.scrollTop=e)}scrollIntoView(t,e){if(t){var r=this.indexFromPos(t);this.cm6.dispatch({effects:F.EditorView.scrollIntoView(r)})}else this.cm6.dispatch({scrollIntoView:!0,userEvent:"scroll"})}getWrapperElement(){return this.cm6.dom}getMode(){return{name:this.getOption("mode")}}setSize(t,e){this.cm6.dom.style.width=t+4+"px",this.cm6.dom.style.height=e+"px",this.refresh()}refresh(){this.cm6.measure()}destroy(){this.removeOverlay()}getLastEditEnd(){return this.posFromIndex(this.$lastChangeEndOffset)}onChange(t){this.$lineHandleChanges&&this.$lineHandleChanges.push(t);for(let r in this.marks)this.marks[r].update(t.changes);this.virtualSelection&&(this.virtualSelection.ranges=this.virtualSelection.ranges.map(r=>r.map(t.changes)));var e=this.curOp=this.curOp||{};t.changes.iterChanges((r,i,a,s,o)=>{(e.$changeStart==null||e.$changeStart>a)&&(e.$changeStart=a),this.$lastChangeEndOffset=s;var l={text:o.toJSON()};e.lastChange?e.lastChange.next=e.lastChange=l:e.lastChange=e.change=l},!0),e.changeHandlers||(e.changeHandlers=this._handlers.change&&this._handlers.change.slice())}onSelectionChange(){var t=this.curOp=this.curOp||{};t.cursorActivityHandlers||(t.cursorActivityHandlers=this._handlers.cursorActivity&&this._handlers.cursorActivity.slice()),this.curOp.cursorActivity=!0}operation(t,e){this.curOp||(this.curOp={$d:0}),this.curOp.$d++;try{var r=t()}finally{this.curOp&&(this.curOp.$d--,this.curOp.$d||this.onBeforeEndOperation())}return r}onBeforeEndOperation(){var t=this.curOp,e=!1;t&&(t.change&&he(t.changeHandlers,this,t.change),t&&t.cursorActivity&&(he(t.cursorActivityHandlers,this,null),t.isVimOp&&(e=!0)),this.curOp=null),e&&this.scrollIntoView()}moveH(t,e){if(e=="char"){var r=this.getCursor();this.setCursor(r.line,r.ch+t)}}setOption(t,e){switch(t){case"keyMap":this.state.keyMap=e;break;case"textwidth":this.state.textwidth=e;break}}getOption(t){switch(t){case"firstLineNumber":return 1;case"tabSize":return this.cm6.state.tabSize||4;case"readOnly":return this.cm6.state.readOnly;case"indentWithTabs":return this.cm6.state.facet(x.indentUnit)=="	";case"indentUnit":return this.cm6.state.facet(x.indentUnit).length||2;case"textwidth":return this.state.textwidth;case"keyMap":return this.state.keyMap||"vim"}}toggleOverwrite(t){this.state.overwrite=t}getTokenTypeAt(t){var e,r=this.indexFromPos(t),i=(0,x.ensureSyntaxTree)(this.cm6.state,r),a=i==null?void 0:i.resolve(r),s=((e=a==null?void 0:a.type)===null||e===void 0?void 0:e.name)||"";return/comment/i.test(s)?"comment":/string/i.test(s)?"string":""}overWriteSelection(t){var e=this.cm6.state.doc,r=this.cm6.state.selection,i=r.ranges.map(a=>{if(a.empty){var s=a.to<e.length?e.sliceString(a.from,a.to+1):"";if(s&&!/\n/.test(s))return v.EditorSelection.range(a.from,a.to+1)}return a});this.cm6.dispatch({selection:v.EditorSelection.create(i,r.mainIndex)}),this.replaceSelection(t)}isInMultiSelectMode(){return this.cm6.state.selection.ranges.length>1}virtualSelectionMode(){return!!this.virtualSelection}forEachSelection(t){var e=this.cm6.state.selection;this.virtualSelection=v.EditorSelection.create(e.ranges,e.mainIndex);for(var r=0;r<this.virtualSelection.ranges.length;r++){var i=this.virtualSelection.ranges[r];i&&(this.cm6.dispatch({selection:v.EditorSelection.create([i])}),t(),this.virtualSelection.ranges[r]=this.cm6.state.selection.ranges[0])}this.cm6.dispatch({selection:this.virtualSelection}),this.virtualSelection=null}hardWrap(t){return nt(this,t)}};d.isMac=typeof navigator!="undefined"&&/Mac/.test(navigator.platform);d.Pos=M;d.StringStream=x.StringStream;d.commands={cursorCharLeft:function(n){(0,g.cursorCharLeft)(n.cm6)},redo:function(n){pe(n,!1)},undo:function(n){pe(n,!0)},newlineAndIndent:function(n){(0,g.insertNewlineAndIndent)({state:n.cm6.state,dispatch:t=>V(n,t)})},indentAuto:function(n){(0,g.indentSelection)(n.cm6)},newlineAndIndentContinueComment:void 0,save:void 0};d.isWordChar=function(n){return te.test(n)};d.keys=Ge;d.addClass=function(n,t){};d.rmClass=function(n,t){};d.e_preventDefault=function(n){n.preventDefault()};d.e_stop=function(n){var t,e;(t=n==null?void 0:n.stopPropagation)===null||t===void 0||t.call(n),(e=n==null?void 0:n.preventDefault)===null||e===void 0||e.call(n)};d.lookupKey=function(t,e,r){var i=d.keys[t];i&&r(i)};d.on=ve;d.off=me;d.signal=ye;d.findMatchingTag=tt;d.findEnclosingTag=rt;d.keyName=void 0;function ke(n,t,e){var r=document.createElement("div");return r.appendChild(t),r}function we(n,t){n.state.currentNotificationClose&&n.state.currentNotificationClose(),n.state.currentNotificationClose=t}function ze(n,t,e){we(n,o);var r=ke(n,t,e&&e.bottom),i=!1,a,s=e&&typeof e.duration!="undefined"?e.duration:5e3;function o(){i||(i=!0,clearTimeout(a),r.remove(),xe(n,r))}return r.onclick=function(l){l.preventDefault(),o()},Ce(n,r),s&&(a=setTimeout(o,s)),o}function Ce(n,t){var e=n.state.dialog;n.state.dialog=t,t&&e!==t&&(e&&e.contains(document.activeElement)&&n.focus(),e&&e.parentElement?e.parentElement.replaceChild(t,e):e&&e.remove(),d.signal(n,"dialog"))}function xe(n,t){n.state.dialog==t&&(n.state.dialog=null,d.signal(n,"dialog"))}function Je(n,t,e,r){r||(r={}),we(n,void 0);var i=ke(n,t,r.bottom),a=!1;Ce(n,i);function s(l){if(typeof l=="string")o.value=l;else{if(a)return;a=!0,xe(n,i),n.state.dialog||n.focus(),r.onClose&&r.onClose(i)}}var o=i.getElementsByTagName("input")[0];return o&&(r.value&&(o.value=r.value,r.selectValueOnOpen!==!1&&o.select()),r.onInput&&d.on(o,"input",function(l){r.onInput(l,o.value,s)}),r.onKeyUp&&d.on(o,"keyup",function(l){r.onKeyUp(l,o.value,s)}),d.on(o,"keydown",function(l){r&&r.onKeyDown&&r.onKeyDown(l,o.value,s)||(l.keyCode==13&&e(o.value),(l.keyCode==27||r.closeOnEnter!==!1&&l.keyCode==13)&&(o.blur(),d.e_stop(l),s()))}),r.closeOnBlur!==!1&&d.on(o,"blur",function(){setTimeout(function(){document.activeElement!==o&&s()})}),o.focus()),s}var Xe={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<","<":">>",">":"<<"};function Ze(n){return n&&n.bracketRegex||/[(){}[\]]/}function et(n,t,e,r,i){for(var a=i&&i.maxScanLineLength||1e4,s=i&&i.maxScanLines||1e3,o=[],l=Ze(i),h=e>0?Math.min(t.line+s,n.lastLine()+1):Math.max(n.firstLine()-1,t.line-s),f=t.line;f!=h;f+=e){var p=n.getLine(f);if(p){var u=e>0?0:p.length-1,m=e>0?p.length:-1;if(!(p.length>a))for(f==t.line&&(u=t.ch-(e<0?1:0));u!=m;u+=e){var y=p.charAt(u);if(l.test(y)){var O=Xe[y];if(O&&O.charAt(1)==">"==e>0)o.push(y);else if(o.length)o.pop();else return{pos:new M(f,u),ch:y}}}}}return f-e==(e>0?n.lastLine():n.firstLine())?!1:null}function tt(n,t){}function rt(n,t){var e,r,i=n.cm6.state,a=n.indexFromPos(t);if(a<i.doc.length){var s=i.sliceDoc(a,a+1);s=="<"&&a++}for(var o=(0,x.ensureSyntaxTree)(i,a),l=(o==null?void 0:o.resolve(a))||null;l;){if(((e=l.firstChild)===null||e===void 0?void 0:e.type.name)=="OpenTag"&&((r=l.lastChild)===null||r===void 0?void 0:r.type.name)=="CloseTag")return{open:ge(i.doc,l.firstChild),close:ge(i.doc,l.lastChild)};l=l.parent}}function ge(n,t){return{from:S(n,t.from),to:S(n,t.to)}}var re=class{constructor(t,e,r){this.cm=t,this.id=t.$mid++,this.offset=e,this.assoc=r,t.marks[this.id]=this}clear(){delete this.cm.marks[this.id]}find(){return this.offset==null?null:this.cm.posFromIndex(this.offset)}update(t){this.offset!=null&&(this.offset=t.mapPos(this.offset,this.assoc,v.MapMode.TrackDel))}};function nt(n,t){for(var e,r=t.column||n.getOption("textwidth")||80,i=t.allowMerge!=!1,a=Math.min(t.from,t.to),s=Math.max(t.from,t.to);a<=s;){var o=n.getLine(a);if(o.length>r){var l=y(o,r,5);if(l){var h=(e=/^\s*/.exec(o))===null||e===void 0?void 0:e[0];n.replaceRange(`
`+h,new M(a,l.start),new M(a,l.end))}s++}else if(i&&/\S/.test(o)&&a!=s){var f=n.getLine(a+1);if(f&&/\S/.test(f)){var p=o.replace(/\s+$/,""),u=f.replace(/^\s+/,""),m=p+" "+u,l=y(m,r,5);l&&l.start>p.length||m.length<r?(n.replaceRange(" ",new M(a,p.length),new M(a+1,f.length-u.length)),a--,s--):p.length<o.length&&n.replaceRange("",new M(a,p.length),new M(a,o.length))}}a++}return a;function y(O,k,j){if(!(O.length<k)){var H=O.slice(0,k),Fe=O.slice(k),P=/^(?:(\s+)|(\S+)(\s+))/.exec(Fe),R=/(?:(\s+)|(\s+)(\S+))$/.exec(H),K=0,ee=0;if(R&&!R[2]&&(K=k-R[1].length,ee=k),P&&!P[2]&&(K||(K=k),ee=k+P[1].length),K)return{start:K,end:ee};if(R&&R[2]&&R.index>j)return{start:R.index,end:R.index+R[2].length};if(P&&P[2])return K=k+P[2].length,{start:K,end:K+P[3].length}}}}var vt=typeof navigator!="undefined"&&/linux/i.test(navigator.platform)&&/ Gecko\/\d+/.exec(navigator.userAgent);function be(n){return n.cm||null}function ne(n,t){let e=n.commands.findCommand(t);return e!=null?e:null}function Se(n){return Object.values(n.commands.commands)}function it(n,t){for(let e of n.getLeavesOfType("markdown"))if(e.view instanceof _.FileView&&e.view.file===t)return e;return null}async function Y(n,t,e={}){var s,o,l,h;let r=t instanceof _.TFile?t:n.vault.getFileByPath(t);if(!r)return;let i=(s=e.external)!=null?s:r.extension!=="md";if(!i&&((o=e.useExisting)==null||o)){let f=it(n.workspace,r);if(f){((l=e.active)==null||l)&&n.workspace.setActiveLeaf(f,{focus:!0});return}}await n.workspace.getLeaf(i?!1:e.newLeaf).openFile(r,{active:i?!1:(h=e.active)!=null?h:!0})}var $=class extends _.Modal{constructor(e,r={}){var o,l,h,f,p;super(e);this.invoked=!1;r.title&&this.setTitle(r.title),r.message&&this.setContent(r.message),this.default=(o=r.default)!=null?o:!0;let i=this.modalEl.createEl("div",{cls:"modal-button-container"});this.yesBtn=i.createEl("button",{text:(l=r.yesText)!=null?l:"Confirm"}),this.yesBtn.addEventListener("click",u=>this.resolve(!0));let a=(h=r.yesCls)!=null?h:"mod-cta";a&&this.yesBtn.addClass(a),this.noBtn=i.createEl("button",{text:(f=r.noText)!=null?f:"Cancel"}),this.noBtn.addEventListener("click",u=>this.resolve(!1));let s=(p=r.noCls)!=null?p:"mod-cancel";s&&this.noBtn.addClass(s)}open(){super.open(),(this.default?this.yesBtn:this.noBtn).focus()}resolve(e){this.callback&&!this.invoked&&(this.invoked=!0,this.callback(e)),this.close()}};function Me(n,t){let{modalEl:e}=n,r=createEl("div",{cls:"spacekeys-modal-title"});return e.insertBefore(r,e.firstChild),t&&(r.textContent=t),r}function Le(n){var r,i;if(!n.editor.hasFocus())return!1;let t=n.editor.cm,e=be(t);return(i=(r=e==null?void 0:e.state.vim)==null?void 0:r.insertMode)!=null?i:!0}var Oe=require("obsidian");var ie=class extends Error{};function W(n,t){if(!n)throw new ie(t)}var A=class extends Error{constructor(e,{details:r,context:i}={}){super(e);this.details=r!=null?r:null,this.context=i!=null?i:null}};function Ee(n){return typeof n=="object"&&!Array.isArray(n)&&n!==null}function ae(n,t){let e={};for(let r in t){let i=t[r];if(r in n){let a=n[r];Ee(i)&&Ee(a)?e[r]=ae(a,i):e[r]=a}else e[r]=i}return e}function Te(n,t=/\s+/){if(t instanceof RegExp){let e=t.exec(n);return e?[n.substring(0,e.index),n.substring(e.index+e[0].length)]:[n,null]}else{let e=n.indexOf(t);return e<0?[n,null]:[n.substring(0,e),n.substring(e+t.length)]}}var Ae=`This is a sample keymap file for the [Spacekeys](http://github.com/jlumpe/obsidian-spacekeys) Obsidian plugin. The keymap itself is defined in a YAML code block below, it is wrapped in a Markdown file to allow editing within Obsidian. To use this file, enter its path in the Spacekeys plugin settings.

You can use the "Spacekeys: Find command ID" command to search for command IDs (either by assigning it a hotkey or invoking it through the command palette). See the plugin's description for more detailed instructions.


`;function oe(n){return typeof n=="object"&&!Array.isArray(n)&&n!==null}var I=class extends Error{constructor(e,r={}){var i,a,s;super(e);this.path=(i=r.path)!=null?i:null,this.data=(a=r.data)!=null?a:null,this.cause=(s=r.cause)!=null?s:null}};function T(n,t,e,r){throw new I(n,{path:r?t.concat(r):t,data:e})}var ot={space:" ",spc:" ",up:"arrowup",down:"arrowdown",left:"arrowleft",right:"arrowright"};function st(n){var a;let t={success:!1,error:"Invalid key code: "+JSON.stringify(n)};if(!n)return t;if(n=="-")return{success:!0,key:new E("-")};let e={},r,i=n.indexOf("-");if(i>=0){let s=n.substring(0,i);if(r=n.substring(i+1).toLowerCase(),!r||!s)return t;for(let o=0;o<s.length;o++)if(s[o]=="c")e.ctrl=!0;else if(s[o]=="s")e.shift=!0;else if(s[o]=="a")e.alt=!0;else if(s[o]=="m")e.meta=!0;else return{success:!1,error:"Invalid modifier code: "+s[o].toUpperCase()}}else r=n;return r.length>1&&(r=r.toLowerCase()),r=(a=ot[r])!=null?a:r,de.test(r)?(N(r)&&(e.shift=!1),{success:!0,key:new E(r,e)}):t}var lt={" ":"spc",arrowup:"up",arrowdown:"down",arrowleft:"left",arrowright:"right"};function Re(n){var r;let t=(r=lt[n.key])!=null?r:n.key,e="";return n.ctrl&&(e+="c"),n.shift&&(e+="s"),n.alt&&(e+="a"),n.meta&&(e+="m"),e?e+"-"+t:t}function ct(n,t){oe(n)||T("Root element not an object",[],n),"items"in n||T('Expected "items" property',[],n);let e=Ie(n,[],t);return W(e instanceof w),e}function Ie(n,t,e){let r;if(typeof n=="string"){let[i,a]=Te(n.trim()," ");r=new b(i,a==null?void 0:a.trim())}else oe(n)?("items"in n?("command"in n&&T('Object has both "items" and "command" properties',t,n),r=ut(n,t,e)):"command"in n?(typeof n.command!="string"&&T("Expected string",t,n.command,["command"]),r=new b(n.command)):T('Object must have either "items" or "command" property',t,n),"description"in n&&(typeof n.description!="string"&&n.description!==null&&T("Expected string or null",t,n.description,["description"]),r.description=n.description)):T("Expected string or object",t,n);return r instanceof b&&!r.command_id&&T("Command ID cannot be empty",t,r.command_id,["command"]),r}function ut(n,t,e){let r;!oe(n.items)&&n.items!==null&&T("Expected group.items to be an object",t,n.item,["items"]),n.clear!==void 0&&typeof n.clear!="boolean"&&T("Expected group.clear to be a bool",t,n.clear,["clear"]),e&&n.clear!==!0?r=e.copy():r=new w;for(let i in n.items){let a=n.items[i],s=st(i);s.success||T(s.error,t,n.items,["items"]);let o=s.key;if(a===null){r.removeChild(o);continue}let l=r.getChild(o),h=l instanceof w?l:void 0,f=Ie(a,t.concat(["items",i]),h);r.setChild(o,f)}return r}function Q(n,t){let e;try{e=(0,Oe.parseYaml)(n)}catch(r){throw new I(String(r),{cause:r})}return ct(e,t)}function Ke(n,t){let e=ft(n);if(!e)throw new I("No code block found");return Q(e,t)}function ft(n){let t=n.matchAll(/^```.*$/mg),e=null;for(let r of t)if(W(r.index),e===null)e=r.index+r[0].length;else return n.substring(e,r.index);return null}function q(n,t){return t&&t!="auto"?t:/\.ya?ml$/.test(n)?"yaml":/\.md$/.test(n)?"markdown":null}function Be(n){let t=Ae;return t+="```yaml\n",t+=n,t+="\n```\n",t}function Pe(n){return n.map(t=>t.basicRepr()).join(" ")}var se={delay:500,execDelay:100,showInvalid:!0,backspaceReverts:!0,backspaceCloses:!0,trimDescriptions:!0,dimBackground:!0},G=class extends L.Modal{constructor(e){super(e.app);this.timeoutHandle=null;this.plugin=e,this.commands=e.keymap,this.settings=Object.assign({},se,e.settings.modal),this.containerEl.addClass("spacekeys-modal-container"),this.modalEl.addClass("spacekeys-modal"),this.modalEl.empty(),this.suggestionsEl=this.modalEl.createEl("div",{cls:"spacekeys-suggestions"}),this.statusEl=this.modalEl.createEl("div",{cls:"spacekeys-modal-status"}),this.isOpen=!1,this.setCollapsed(!0),this.dimBackground=this.settings.dimBackground,this.keySequence=[],this.scope.register(null,null,this.handleKey.bind(this))}onOpen(){super.onOpen(),this.isOpen=!0,this.settings.delay<=0?this.setCollapsed(!1):this.setExpandTimer(),this.update()}onClose(){super.onClose(),this.isOpen=!1,this.clearExpandTimer(),this.setCollapsed(!0)}setExpandTimer(){this.clearExpandTimer(),this.isOpen&&this.isCollapsed&&(this.timeoutHandle=window.setTimeout(()=>this.delayedExpand(),this.settings.delay))}clearExpandTimer(){this.timeoutHandle!==null&&window.clearTimeout(this.timeoutHandle),this.timeoutHandle=null}delayedExpand(){this.timeoutHandle=null,this.isOpen&&this.setCollapsed(!1)}setCollapsed(e){e=e&&this.settings.delay>0,this.isCollapsed=e,this.containerEl.toggleClass("spacekeys-modal-collapsed",e)}handleKey(e,r){if(this.settings.delay>0&&this.setExpandTimer(),this.settings.backspaceReverts&&r.key=="Backspace"){this.settings.backspaceCloses&&this.keySequence.length==0?this.close():(this.keySequence.pop(),this.update());return}this.keySequence.push(E.fromEvent(e)),this.update(),e.preventDefault()}update(){let e=this.commands.find(this.keySequence);if(e instanceof b){this.tryExec(e.command_id),this.close();return}let r=this.keySequence.length==0;if(this.statusEl.toggleClass("spacekeys-modal-status-empty",r),this.statusEl.empty(),this.keySequence.length==0?this.statusEl.appendText("<waiting on input>"):this.statusEl.appendText(Pe(this.keySequence)),this.suggestionsEl.empty(),e===null){this.invalidKeys(),this.close();return}let i=this.getSuggestions(e);for(let a of i){let s=this.suggestionsEl.createEl("div");this.renderSuggestion(a,s)}}getSuggestions(e){let r=[];for(let i of e.children){let a={key:i.key,item:i.item,command:i.item instanceof b?ne(this.app,i.item.command_id):null};(this.settings.showInvalid||!(i.item instanceof b&&a.command===null))&&r.push(a)}return r.sort(this.compareSuggestions.bind(this)),r}compareSuggestions(e,r){let i=e.item instanceof w,a=r.item instanceof w;return i&&!a?-1:a&&!i?1:E.compare(e.key,r.key)}renderKey(e,r){let i=e.fancyRepr();r.addClass("spacekeys-suggestion-key"),r.createEl("kbd",{text:i})}renderSuggestion(e,r){r.addClass("spacekeys-suggestion");let i=e.item.description;e.item instanceof b?(r.addClass("spacekeys-command"),e.command?(e.command.id==="spacekeys:repeat-last"&&(this.plugin.lastCommand?i!=null||(i="Repeat: "+this.getCommandDescription(this.plugin.lastCommand.name)):r.addClass("spacekeys-invalid")),i!=null||(i=this.getCommandDescription(e.command.name))):(r.addClass("spacekeys-invalid"),i!=null||(i=e.item.command_id))):r.addClass("spacekeys-group");let a=r.createEl("div");this.renderKey(e.key,a),r.createEl("div",{cls:"spacekeys-suggestion-label",text:i!=null?i:"?"}),r.setAttr("title",i)}getCommandDescription(e){var r,i;return this.settings.trimDescriptions&&(i=(r=/^.+:\s*(.*)/.exec(e))==null?void 0:r[1])!=null?i:e}tryExec(e){let r=ne(this.app,e);r?this.execCommand(r):this.invalidCommand(e)}invalidCommand(e){let r=JSON.stringify(e),i=document.createDocumentFragment();i.appendText("Unknown command: "),i.createEl("code",{text:r}),new L.Notice(i),console.error("Invalid command ID: "+r)}execCommand(e){window.setTimeout(()=>this.app.commands.executeCommand(e),this.settings.execDelay),e.id!=="spacekeys:repeat-last"&&(this.plugin.lastCommand=e)}invalidKeys(){let e=Pe(this.keySequence),r=document.createDocumentFragment();r.appendText("Invalid key sequence: "),r.createEl("code",{text:e}),new L.Notice(r)}},z=class extends L.FuzzySuggestModal{constructor(t){super(t);let e=Me(this);e.createEl("strong",{text:"Spacekeys"}),e.appendText(": find command"),this.setInstructions([{command:"\u21B5",purpose:"Copy ID"},{command:"Ctrl + \u21B5",purpose:"Insert ID"}]),this.scope.register(["Ctrl"],"Enter",(r,i)=>{this.chooser.useSelectedItem(r)})}getItems(){return Se(this.app)}getItemText(t){return t.name+" "+t.id}onChooseItem(t,e){e.ctrlKey?this.insertCommand(t):this.copyCommand(t)}copyCommand(t){navigator.clipboard.writeText(t.id),new L.Notice("Copied to clipboard: "+t.id)}insertCommand(t){let e=this.app.workspace.getActiveViewOfType(L.MarkdownView);e&&e.editor.replaceSelection(t.id)}},J=class extends L.Modal{constructor(e){super(e);this.keycodes="";this.initContents(),this.scope.register(null,null,this.handleKey.bind(this))}initContents(){this.setTitle("Spacekeys key code finder");let e=`
		Enter one or more keypresses to get their key codes.
		Press Esc to close the modal and copy the key codes to the clipboard.
		`;this.contentEl.createEl("p",{text:e}),this.text=this.contentEl.createEl("input",{type:"text"}),this.text.addClass("spacekeys-key-code-generator"),this.text.readOnly=!0}handleKey(e,r){let i=E.fromEvent(e),a=Re(i);this.keycodes&&(this.keycodes+=" "),this.keycodes+=a,this.text.value=this.keycodes,e.preventDefault()}onClose(){super.onClose(),this.keycodes&&(navigator.clipboard.writeText(this.keycodes),new L.Notice("Key code(s) copied to clipboard"))}};var Ne=`items:
  SPC: command-palette:open
  TAB: editor:focus
  /: global-search:open
  ",": editor:context-menu
  "?": switcher:open
  P: app:go-back
  N: app:go-forward
  .: spacekeys:repeat-last

  w:
    description: Workspace
    items:
      TAB: editor:focus
      d: workspace:close
      f: file-explorer:open
      h: editor:focus-left
      l: editor:focus-right
      k: editor:focus-top
      j: editor:focus-bottom
      n: workspace:next-tab
      N: workspace:new-tab
      o: outline:open
      p: workspace:previous-tab
      P: workspace:toggle-pin
      s: workspace:split-horizontal
      S: workspace:toggle-stacked-tabs
      t: tag-pane:open
      u: workspace:undo-close-pane
      v: workspace:split-vertical
      L: app:toggle-left-sidebar
      r: app:toggle-right-sidebar
      R: app:toggle-ribbon
      w: workspace:open-in-new-window
      W: workspace:move-to-new-window

      x:
        description: Close
        items:
          g: workspace:close-tab-group
          G: workspace:close-others-tab-group
          t: workspace:close
          T: workspace:close-others
          w: workspace:close-window

       # workspace:goto-tab-1
       # workspace:goto-tab-2
       # workspace:goto-tab-3
       # workspace:goto-tab-4
       # workspace:goto-tab-5
       # workspace:goto-tab-6
       # workspace:goto-tab-7
       # workspace:goto-tab-8
       # workspace:goto-last-tab

       # workspace:show-trash

  f:
    description: File
    items:
      a: markdown:add-alias
      c: workspace:copy-path
      C: workspace:copy-url
      d: app:delete-file
      m: file-explorer:move-file
      o: open-with-default-app:open
      O: open-with-default-app:show
      r: editor:open-search-replace
      R: workspace:edit-file-title
      s: editor:save-file
      t: file-explorer:reveal-active-file
      T: tag-pane:open
      u: outline:open-for-current
      /: editor:open-search

      n:
        description: New
        items:
          c: file-explorer:duplicate-file
          n: file-explorer:new-file
          N: file-explorer:new-file-in-current-tab
          r: file-explorer:new-file-in-new-pane


      p:
        description: Properties
        items:
          a: markdown:add-metadata-property
          e: markdown:edit-metadata-property
          c: markdown:clear-metadata-properties

  x:
    description: Text
    items:
      b: editor:toggle-bold
      c: editor:toggle-code
      C: editor:toggle-comments
      d: editor:delete-paragraph
      F: editor:clear-formatting
      i: editor:toggle-italics
      p: editor:insert-codeblock
      q: editor:toggle-blockquote
      s: editor:toggle-strikethrough
      l: editor:toggle-bullet-list
      H: editor:toggle-highlight
      M: editor:toggle-inline-math

      # editor:set-heading
      # editor:set-heading-0
      # editor:set-heading-1
      # editor:set-heading-2
      # editor:set-heading-3
      # editor:set-heading-4
      # editor:set-heading-5
      # editor:set-heading-6
      # editor:rename-heading

      # editor:swap-line-down
      # editor:swap-line-up

      # editor:toggle-bullet-list
      # editor:toggle-checklist-status
      # editor:toggle-numbered-list
      # editor:cycle-list-checklist

  i:
    description: Insert
    items:
      a: editor:attach-file
      c: editor:insert-codeblock
      C: editor:insert-callout
      e: editor:insert-embed
      l: editor:insert-link
      L: editor:insert-wikilink
      m: editor:insert-mathblock
      r: editor:insert-horizontal-rule
      T: editor:insert-tag

      t:
        description: Template
        items:
          t: insert-template
          d: insert-current-date
          T: insert-current-time

  t:
    description: Table
    items:
      h: editor:table-col-left
      l: editor:table-col-right
      k: editor:table-row-up
      j: editor:table-row-down
      c: editor:table-col-after
      C: editor:table-col-before
      r: editor:table-row-after
      R: editor:table-row-before
      v: editor:table-row-copy
      V: editor:table-col-copy
      i: editor:insert-table

      d:
        description: Delete
        items:
          c: editor:table-col-delete
          r: editor:table-row-delete

      a:
        description: Align
        items:
          c: editor:table-col-align-center
          l: editor:table-col-align-left
          r: editor:table-col-align-right

  v:
    description: View
    items:
      p: editor:toggle-source
      r: markdown:toggle-preview
      s: editor:toggle-spellcheck
      T: window:toggle-always-on-top

      # window:reset-zoom
      # window:zoom-in
      # window:zoom-out

  # "Workspaces" core plugin
  l:
    description: Layout
    items:
      l: workspaces:save-and-load
      L: workspaces:load
      o: workspaces:open-modal
      s: workspaces:save

# editor:toggle-fold-properties
# editor:toggle-fold
# editor:unfold-all
# editor:fold-all
# editor:fold-less
# editor:fold-more

# editor:follow-link
# editor:open-link-in-new-leaf
# editor:open-link-in-new-split
# editor:open-link-in-new-window

`;var X={default:Ne};function B(...n){}var De={keymapFile:{path:null,format:"auto",extend:!1,autoReload:!1},modal:se,activateOnSpace:"disabled"};function le(n){if(!(n in X))return console.error("No builtin keymap named "+n),null;let t=X[n];try{return Q(t)}catch(e){console.error("Error parsing default keymap "+n),e instanceof I?console.error(e.message,e.path,e.data):console.error(e)}return null}var Z=class extends c.Plugin{constructor(){super(...arguments);this.lastCommand=null;this.spaceHandler=null;this.fileWatcher=null;this.debouncedReloadKeymap=(0,c.debounce)(()=>this.tryLoadKeymap(),500,!0)}async onload(){var e;console.log("Loading plugin: Spacekeys"),B("development build"),this.registerCommands(),this.keymap=(e=le("default"))!=null?e:new w,await this.loadSettings(),this.addSettingTab(new ce(this.app,this)),this.updateSpaceHandler(),this.app.workspace.onLayoutReady(()=>{this.settings.keymapFile.path&&(this.tryLoadKeymap({notifySuccess:!1}),this.updateFileWatcher())})}onunload(){this.updateSpaceHandler(!1),this.updateFileWatcher(!1)}registerCommands(){this.addCommand({id:"leader",name:"Leader",callback:()=>this.activateLeader()}),this.addCommand({id:"load-keymap",name:"Reload keymap",callback:()=>this.tryLoadKeymap({onError:"modal"})}),this.addCommand({id:"find-command",name:"Find command ID",callback:()=>{new z(this.app).open()}}),this.addCommand({id:"get-keycode",name:"Get key code",callback:()=>{new J(this.app).open()}}),this.addCommand({id:"repeat-last",name:"Repeat last command",callback:()=>this.repeatLastCommand()})}async loadSettings(){let e=await this.loadData();if(e===null){this.settings=De;return}this.settings=ae(e,De)}async saveSettings(){this.settings.pluginVersion=this.manifest.version,await this.saveData(this.settings),this.updateFileWatcher()}activateLeader(){new G(this).open()}repeatLastCommand(){this.lastCommand?this.lastCommand.id==="spacekeys:repeat-last"?console.warn("Last command was repeat-last!"):this.app.commands.executeCommand(this.lastCommand):new c.Notice("No last command to repeat")}isActivateOnSpaceEnabled(){let e=this.settings.activateOnSpace;return e=="enabled"||e=="markdown_only"}updateSpaceHandler(e=null){e=e!=null?e:this.isActivateOnSpaceEnabled();let r=this.app.keymap.getRootScope();e?this.spaceHandler===null&&(B("Registering space event handler"),this.spaceHandler=r.register([]," ",this.handleSpace.bind(this))):this.spaceHandler!==null&&(B("Unregistering space event handler"),r.unregister(this.spaceHandler),this.spaceHandler=null)}handleSpace(e,r){var o,l,h;if(!this.isActivateOnSpaceEnabled())return!0;let i=this.app.workspace.getActiveViewOfType(c.MarkdownView),a=(o=this.app.workspace.activeLeaf)==null?void 0:o.view.getViewType(),s=!!((l=document.activeElement)!=null&&l.closest("div.cm-content"));if(i&&s){if(Le(i))return!0}else{if(!i&&this.settings.activateOnSpace=="markdown_only"||a==="webviewer"||a==="canvas")return!0;let f=(h=document.activeElement)==null?void 0:h.tagName;if(f=="INPUT"||f=="TEXTAREA"||document.activeElement instanceof HTMLElement&&document.activeElement.contentEditable=="true")return!0}return this.activateLeader(),!1}async loadKeymap(){let e=this.settings.keymapFile.path,r;if(!e)throw new A("Keymap file not set in plugin settings");let i=this.app.vault.getFileByPath(e);if(i===null)throw new A("File not found");let a=q(e,this.settings.keymapFile.format);if(a==null)throw new A("Could not guess format of file from extension");B("loading keymap from "+e);try{r=await this.app.vault.cachedRead(i)}catch(o){throw console.error(o),new A("Unable to read file",{context:o})}let s=this.settings.keymapFile.extend&&le("default")||void 0;try{a==="markdown"?this.keymap=Ke(r,s):this.keymap=Q(r,s)}catch(o){let l=o instanceof I?o.message:null;throw new A("Parse error",{details:l,context:o})}}async tryLoadKeymap({allowDefault:e=!1,notifySuccess:r=!0,onError:i="notice"}={}){if(!this.settings.keymapFile.path&&e){let a=le("default");return W(a),this.keymap=a,{loaded:!1,error:null}}try{await this.loadKeymap()}catch(a){if(!(a instanceof A))throw a;let s=`Spacekeys: failed to load keymap (${a.message})`;return console.error(s),a.context&&console.error(a.context),i==="notice"?new c.Notice(s,5e3):i==="modal"&&this.showLoadErrorModal(a),{loaded:!1,error:a}}return r&&new c.Notice("Spacekeys: keymap reloaded"),{loaded:!0,error:null}}showLoadErrorModal(e){var s;let r=new c.Modal(this.app);r.setTitle("Spacekeys: Error loading keymap"),r.modalEl.addClass("spacekeys-keymap-error");let i=r.contentEl.createEl("dl");function a(o,l){return i.createEl("dt",{text:o+":"}),i.createEl("dd",{text:l!=null?l:""})}if(a("Error",e.message),a("File").createEl("code",{text:(s=this.settings.keymapFile.path)!=null?s:"<unset>"}),e.context instanceof I){let{path:o,cause:l}=e.context,h=a("Details");if(l?h.createEl("pre",{text:l.message}):h.setText(e.context.message),o!==null){let f=a("YAML path");o?f.createEl("code",{text:o.join(".")}):f.setText("Root element")}}else e.details&&a("Details",e.details);new c.Setting(r.contentEl).addButton(o=>o.setButtonText("OK").setCta().onClick(l=>r.close())),r.open()}updateFileWatcher(e){e!=null||(e=this.settings.keymapFile.path&&this.settings.keymapFile.autoReload||!1),e&&!this.fileWatcher&&(B("Registering keymap file watcher"),this.fileWatcher=this.app.vault.on("modify",r=>{r.path===this.settings.keymapFile.path&&(B("Keymap file modified, reloading"),this.debouncedReloadKeymap())})),!e&&this.fileWatcher&&(B("Unregistering keymap file watcher"),this.app.vault.offref(this.fileWatcher),this.fileWatcher=null)}},ce=class extends c.PluginSettingTab{constructor(e,r){super(e,r);this.plugin=r}display(){let{containerEl:e}=this;e.empty(),new c.Setting(e).setName("Spacekeys keymap file").setDesc("YAML or Markdown file defining a custom keymap (see plugin description).").setHeading().addButton(r=>r.setIcon("refresh-cw").setTooltip("(Re)load keymap from file").onClick(i=>this.plugin.tryLoadKeymap({onError:"modal"})).setClass("mod-cta")).addButton(r=>r.setIcon("file-plus-2").setTooltip("Create file with default contents").onClick(i=>this.createFile())).addButton(r=>r.setIcon("pencil").setTooltip("Open file for editing").onClick(i=>this.openFile())).addButton(r=>r.setIcon("external-link").setTooltip("Show file in system explorer").onClick(i=>this.showFile())),new c.Setting(e).setName("Path").setDesc("Path to file within your vault, including extension (.md, .yml).").addText(r=>{var i;return r.setPlaceholder("spacekeys.md").setValue((i=this.plugin.settings.keymapFile.path)!=null?i:"").onChange(async a=>{a=a.trim(),this.plugin.settings.keymapFile.path=a?(0,c.normalizePath)(a):null,await this.plugin.saveSettings()})}),new c.Setting(e).setName("Format").setDesc('Force parsing as specified format, or leave on "Auto" to determine based on file extension.').addDropdown(r=>r.addOptions({auto:"Auto",markdown:"Markdown",yaml:"YAML"}).setValue(this.plugin.settings.keymapFile.format).onChange(async i=>{this.plugin.settings.keymapFile.format=i,await this.plugin.saveSettings()})),new c.Setting(e).setName("Extend default").setDesc("File extends the default keymap instead of defining a new one.").addToggle(r=>r.setValue(this.plugin.settings.keymapFile.extend).onChange(async i=>{this.plugin.settings.keymapFile.extend=i,await this.plugin.saveSettings()})),new c.Setting(e).setName("Auto reload").setDesc("Automatically reload keymap when file changed.").addToggle(r=>r.setValue(this.plugin.settings.keymapFile.autoReload).onChange(async i=>{this.plugin.settings.keymapFile.autoReload=i,await this.plugin.saveSettings()})),new c.Setting(e).setHeading().setName("Behavior"),new c.Setting(e).setName("Delay").setDesc("Delay before expanding suggestions modal (milliseconds).").addText(r=>r.setValue(""+this.plugin.settings.modal.delay).onChange(async i=>{let a=parseInt(i);this.plugin.settings.modal.delay=a>0?a:0,await this.plugin.saveSettings()})),new c.Setting(e).setName("Backspace undoes last keypress").setDesc("Pressing backspace while the leader modal is open undoes the last keypress. You can disable this to assign commands to the backspace key.").addToggle(r=>r.setValue(this.plugin.settings.modal.backspaceReverts).onChange(async i=>{this.plugin.settings.modal.backspaceReverts=i,await this.plugin.saveSettings()})),new c.Setting(e).setName("Backspace closes on empty").setDesc("Attempting to undo the last keypress when there is no input closes the leader modal.").addToggle(r=>r.setValue(this.plugin.settings.modal.backspaceCloses).onChange(async i=>{this.plugin.settings.modal.backspaceCloses=i,await this.plugin.saveSettings()})),new c.Setting(e).setHeading().setName("Appearance"),new c.Setting(e).setName("Dim background").setDesc("Dim the rest of the window when displaying key suggestions.").addToggle(r=>r.setValue(this.plugin.settings.modal.dimBackground).onChange(async i=>{this.plugin.settings.modal.dimBackground=i,await this.plugin.saveSettings()})),new c.Setting(e).setName("Shorten command labels").setDesc("Hide the part of the command description before the colon (if any). This is typically redundant. Does not apply to command descriptions set explicitly in the keymap file.").addToggle(r=>r.setValue(this.plugin.settings.modal.trimDescriptions).onChange(async i=>{this.plugin.settings.modal.trimDescriptions=i,await this.plugin.saveSettings()})),new c.Setting(e).setName("Show invalid commands").setDesc("Show key sequences with invalid command IDs. This can help with debugging your key map file.").addToggle(r=>r.setValue(this.plugin.settings.modal.showInvalid).onChange(async i=>{this.plugin.settings.modal.showInvalid=i,await this.plugin.saveSettings()})),new c.Setting(e).setHeading().setName("Experimental").setDesc("Features in this section may not work correctly."),new c.Setting(e).setName("Activate on space").setDesc("Activate when pressing spacebar (when not inserting text).").addDropdown(r=>r.addOptions({disabled:"Disabled",enabled:"Enabled",markdown_only:"Markdown only"}).setValue(this.plugin.settings.activateOnSpace).onChange(async i=>{this.plugin.settings.activateOnSpace=i,await this.plugin.saveSettings(),this.plugin.updateSpaceHandler()}))}async createFile(){let e=this.plugin.settings.keymapFile.path;if(!e)return;let r=q(e,this.plugin.settings.keymapFile.format);if(r==null)throw new A("Could not guess format of file from extension");let i=X.default,a=r==="markdown"?Be(i):i,s=this.app.vault.getFileByPath(e);if(s){let o=new $(this.app,{title:"Keymap file exists",message:`The file "${e}" exists, overwrite?`,yesText:"Overwrite",yesCls:"mod-warning",default:!1});o.callback=async l=>{l&&(await this.app.vault.modify(s,a),Y(this.app,s,{newLeaf:"tab"}))},o.open()}else{let o=await this.app.vault.create(e,a);Y(this.app,o,{newLeaf:"tab"})}}openFile(){let e=this.plugin.settings.keymapFile.path;if(!e)return;let r=this.app.vault.getAbstractFileByPath(e);if(!(r instanceof c.TFile)){new c.Notice("Not a file: "+e);return}let i=q(e,this.plugin.settings.keymapFile.format);Y(this.app,r,{newLeaf:i=="markdown"?"tab":!1})}showFile(){let e=this.plugin.settings.keymapFile.path;e&&this.app.showInFolder(e)}};

/* nosourcemap */